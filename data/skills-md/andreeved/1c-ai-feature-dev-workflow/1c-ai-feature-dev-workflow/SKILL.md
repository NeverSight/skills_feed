---
name: 1c-ai-feature-dev-workflow
description: Обеспечивает комплексную разработку 1C-доработок через анализ кодовой базы, проектирование архитектуры и следование стандартам 1С
---

# Разработка доработок 1C

Ты помогаешь разработчику реализовать новую доработку 1C. Следуй системному подходу: глубоко пойми кодовую базу, выяви и задай вопросы обо всех недетализированных деталях, спроектируй элегантную архитектуру (сохрани в файле `.tasks/task-[feature-name]/plan.md`), затем реализуй.

## Core Principles

- **Задавай уточняющие вопросы**: выявляй все неоднозначности, граничные случаи и недетализированное поведение. Задавай конкретные вопросы вместо того, чтобы делать предположения. Жди ответов пользователя перед реализацией. Задавай вопросы рано (после понимания кодовой базы, до проектирования архитектуры).
- **Понимай перед действием**: сначала читай и осознавай существующие паттерны кода
- **Читай файлы, указанные агентами**: при запуске агентов проси их возвращать списки самых важных файлов для чтения. После завершения агентов читай эти файлы для построения детального контекста.
- **Просто и элегантно**: приоритет читаемому, поддерживаемому, архитектурно корректному коду
- **Используй TodoWrite**: отслеживай весь прогресс
- Даже если ты думаешь что задача простая, и агенты описанные в фазе не нужны, **в любом случае запусти их, иначе ты упустишь контекст**.

---

## Phase 1: Discovery

**Цель**: понять, что нужно построить

Начальный запрос: $ARGUMENTS

**Действия**:
1. Создай список задач со всеми фазами
2. Если доработка неясна, спроси пользователя:
   - Какую проблему они решают?
   - Что должна делать доработка?
   - Есть ли ограничения или требования?
3. Резюмируй понимание и получи подтверждение от пользователя

---

## Phase 2: Исследование кодовой базы 1C

**Цель**: понять существующий код и паттерны на высоком и низком уровнях

**Действия**:
1. **ОБЯЗАТЕЛЬНО** запусти **3 агента** `1c-code-explorer` параллельно. Каждый агент должен:
   - Всесторонне анализировать код, фокусируясь на полном понимании абстракций, архитектуры и потока управления
   - Нацеливаться на разные аспекты кодовой базы (похожие доработки, высокоуровневое понимание, архитектурное понимание, пользовательский опыт и т.д.)
   - Включить список 5-10 ключевых файлов для чтения

   **Примеры промптов для агентов**:
   - "Найди доработки, похожие на [доработка], и всесторонне проанализируй их реализацию"
   - "Построй карту архитектуры и абстракций для [область доработки], всесторонне анализируя код"
   - "Проанализируй текущую реализацию [существующая доработка/область], проводя всесторонний анализ кода"

2. Когда агенты вернут результаты, прочитай все файлы, указанные агентами для глубокого понимания
3. Представь полную сводку найденных паттернов

---

## Phase 3: Уточняющие вопросы

**Цель**: заполнить пробелы и разрешить все неоднозначности до проектирования

**КРИТИЧНО**: это одна из самых важных фаз. НЕ ПРОПУСКАЙ.

**Действия**:
1. Просмотри находки по кодовой базе и исходный запрос на доработку
2. Выяви недетализированные аспекты: граничные случаи, обработка ошибок, точки интеграции, границы области, предпочтения дизайна, обратная совместимость, потребности производительности
3. **Представь все вопросы пользователю в ясном, организованном списке**
4. **Жди ответов перед проектированием архитектуры**

Если пользователь говорит "как считаешь нужным", предоставь свою рекомендацию и получи явное подтверждение.

---

## Phase 4: Проектирование архитектуры

**Цель**: спроектировать несколько подходов к реализации с разными компромиссами

**Действия**:
1. **ОБЯЗАТЕЛЬНО** запусти **3 агента** `1c-code-architect` параллельно с разным фокусом: минимальные изменения (наименьшее изменение, максимальное переиспользование), чистая архитектура (поддерживаемость, элегантные абстракции), прагматичный баланс (скорость + качество)
2. Просмотри все подходы и сформируй мнение о том, какой лучше подходит для этой задачи (учитывая: небольшое исправление против большой доработки, срочность, сложность, контекст команды)
3. Представь пользователю: краткое резюме каждого подхода, сравнение компромиссов, **твою рекомендацию с обоснованием**, конкретные различия реализации
4. **Спроси пользователя, какой подход он предпочитает**
5. После выбора пользователем создай файл `.tasks/task-[feature-name]/plan.md` с полным планом реализации, включающим:
   - Постановку задачи
   - Выбранный архитектурный подход с обоснованием
   - Найденные паттерны и соглашения из Phase 2
   - Ответы на уточняющие вопросы из Phase 3
   - Конкретные объекты метаданных для создания/изменения
   - Mermaid-диаграммы
   - Последовательность реализации
   - План должен быть полноценным, чтобы человек или llm без контекста беседы, смог полностью понять задачу, и решение

---

## Phase 5: Реализация

**Цель**: построить доработку

**НЕ НАЧИНАЙ БЕЗ ОДОБРЕНИЯ ПОЛЬЗОВАТЕЛЯ, ПОЛЬЗОВАТЕЛЬ ДОЛЖЕН ЯВНО УТВЕРДИТЬ ПЛАН ЗАПИСАННЫЙ В ФАЙЛ**

**Действия**:
1. Жди явного одобрения пользователя
2. Прочитай файл плана `.tasks/task-[feature-name]/plan.md`, созданный на Phase 4
3. Запусти агента `1c-code-writer` для реализации доработки. Передай ему:
   - Путь к файлу плана `.tasks/task-[feature-name]/plan.md`
   - Указание прочитать план и следовать ему
4. Агент `1c-code-writer` прочитает план, прочитает `1c-rules.md` и реализует код
5. Обновляй задачи в плане по мере прогресса

---

## Phase 6: Проверка качества

**Цель**: убедиться, что код простой, DRY, элегантный, читаемый и функционально корректный

**Действия**:
1. **ОБЯЗАТЕЛЬНО** запусти **3 агента** `1c-code-reviewer` параллельно с разным фокусом: простота/DRY/элегантность, баги/функциональная корректность, соглашения проекта/абстракции
2. Консолидируй их ответы и выяви проблемы наивысшей серьезности, которые рекомендуешь исправить
3. **Представь выявленные проблемы пользователю и спроси, что он хочет сделать** (исправить сейчас, исправить позже или продолжить как есть)
4. **Если пользователь выбрал "исправить сейчас":**
   - Добавь выявленные проблемы в файл плана `.tasks/task-[feature-name]/plan.md` в секцию "Найденные проблемы: исправить сейчас"
   - Запусти агента `1c-code-writer`, передав ему:
     - Путь к файлу плана
     - Указание исправить только проблемы из секции "исправить сейчас"
   - После завершения агента **вернись к началу Phase 6** (повторная проверка)
   - Повторяй итерации, пока `1c-code-reviewer` не перестанет находить критические проблемы
5. **Если пользователь выбрал "исправить позже":**
   - Добавь выявленные проблемы в файл плана `.tasks/task-[feature-name]/plan.md` в секцию "Найденные проблемы: исправить позже"
   - Отметь в плане, что эти проблемы отложены
   - Переходи к Phase 7
6. **Если пользователь выбрал "продолжить как есть"** — переходи к Phase 7 без изменений в плане

---

## Phase 7: Итоги

**Цель**: документировать, что было выполнено

**Действия**:
1. Отметь все задачи выполненными
2. Резюмируй:
   - Что было построено
   - Ключевые принятые решения
   - Изменённые файлы
   - Предлагаемые следующие шаги

---
