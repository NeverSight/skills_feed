---
name: session-pretty-replay
description: 将Agent会话的原始JSON/JSONL记录转换为易读文本，并输出一些基础统计信息。Use when 需要回放Agent会话记录、转换会话JSON/JSONL为人类可读格式。
metadata:
  version: 1.0.0
  catalog: utility
  tags: 
  - session replay
  - session render
  - 回放会话json
  - 渲染会话json
  author: kit101
  createdAt: 2026-02-04
  updatedAt: 2026-02-05
when: |
  当用户明确要求将会话JSON/JSONL文件转换为易读格式时触发，典型的触发语句包括：
  - 请回放这个会话记录
  - 回放会话 xxx.jsonl/xxx.json
  - 将这个JSON会话转换为可读格式
  - 展示会话的回放效果
  - 格式化这个聊天/会话记录
  - 渲染session的JSON/JSONL记录
  - 渲染这个Agent会话文件
  【模糊触发】当用户指令中同时包含「会话/session」+「JSON/JSONL/记录/日志」+「回放/渲染/格式化/可读」任意组合时，触发本Skill。

---
# 会话回放工具

## 1. When (触发条件)
当用户明确要求将会话JSON/JSONL文件转换为易读格式时触发，典型的触发语句包括：
- 请回放这个会话记录
- 回放会话 xxx.jsonl/xxx.json
- 将这个JSON会话转换为可读格式
- 展示会话的回放效果
- 格式化这个聊天/会话记录
- 渲染session的JSON/JSONL记录
- 渲染这个Agent会话文件
【模糊触发】当用户指令中同时包含「会话/session」+「JSON/JSONL/记录/日志」+「回放/渲染/格式化/可读」任意组合时，触发本Skill。

## 2. How (执行方式)

### 2.1 重要规则
1. **禁止**生成脚本或代码，完全基于**大模型**输出格式化文本

### 2.2 Steps
1. **读取回放指导文件**: 读取`references`下的JSON数据规格、回放输出规则、回放示例作为指导文件。see `6. 参考资源`。
2. **读取输入文件**: 读取用户提供的会话JSON/JSONL文件，若是大文件则分批次输出回放
3. **解析会话结构**: 识别消息类型（系统、助手、工具、用户、结果等），对于未知的消息类型进行灵活变通处理
4. **（可选）考虑读取案例**: 考虑读取一些案例来加深理解输出格式
5. **生成回放结果**: 输出格式化的文本回放
   - 默认直接输出到控制台(STDOUT)
   - 用户明确要求时，保存到文件
6. **会话摘要、基础统计**：统计工具调用次数、token用量、模型等使用情况，追加会话摘要、基础统计到已有文件，或者直接输出到控制台

## 3. What (输出结果)
### 3.1 主要输出
- **格式化回放**: 按照回放规则展示的易读会话
- **会话摘要**: 关键节点和重要信息的简要概述
- **基础统计**: 工具使用次数、token消耗、模型使用等量化数据

### 3.2 输出格式要求
- 严格遵循`references/session-replay-rules.md`的格式规范
- 保持时间顺序和逻辑关系的准确性
- 使用统一的视觉标识符和分隔符
- 统计信息以清晰的表格或列表形式呈现

## 4. Failure Strategy (失败策略)
### 4.1 数据格式问题
- **JSON语法错误**: 返回具体错误位置和修正建议
- **字段缺失**: 使用默认值填充并标注缺失信息
- **不支持的格式**: 明确说明支持的格式类型

### 4.2 处理性能问题
- **超大会话**: 建议分段处理或提供简化版本
- **处理超时**: 返回已完成部分并建议优化方案
- **资源不足**: 降低处理精度但仍保证基本功能

### 4.3 质量保证
- **格式验证**: 检查输出是否符合模板规范
- **完整性检查**: 确保所有重要信息都被包含
- **一致性维护**: 保持同类消息的展示方式统一

## 5. 核心能力
### 5.1 会话格式化
- 支持JSON和JSONL两种输入格式
- 自动识别和分类不同类型的消息
- 应用预定义的视觉样式和布局
- 保持会话的原始语义和逻辑关系

### 5.2 基础统计
- 工具调用次数统计（按工具类型分类）
- Token用量统计（输入/输出/总计）
- 模型使用情况统计
- 会话时长和消息数量统计

## 6. 参考资源
- `references/session-json-spec.md` - JSON数据格式规范
- `references/session-replay-rules.md` - 回放输出规则
- `references/session-replay-example.txt` - 回放输出示例
- `assets/cases/` - 实际回放案例

## 7. 使用限制
- 仅提供格式化和基础统计功能
- 不进行深度分析或行为解读
- 不提供调试建议或问题诊断
- 输出严格基于输入数据，不做推测或补充