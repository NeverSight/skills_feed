Организуйте регистрацию DI с помощью методов расширения IServiceCollection. Группируйте связанные службы в компонуемые методы Add* для очистки Program.cs и повторного использования конфигурации в тестах.
