Prevent semantic code duplication with capability index and check-before-write
